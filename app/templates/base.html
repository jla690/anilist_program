<!DOCTYPE html>
<html data-theme="light" lang="en">
<head>
    <meta charset="utf-8"/>
    <title>{% block title %}AniList Local{% endblock %}</title>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <meta content="light dark" name="color-scheme"/>
    <link href="/static/css/styles.css" rel="stylesheet">
    {% block head_extra %}{% endblock %}
</head>
<body>
<header class="site-header">
    <div class="brand">
        <a class="logo" href="/">AniList<span class="accent">Local</span></a>
    </div>
    <nav class="main-nav">
        <ul>
            <li><a href="/search">Search</a></li>
            <li><a href="/lists">My Lists</a></li>
            {% if user %}
            <li class="user-block">
                {% if user.avatar.medium %}
                <img alt="{{ user.name }}" class="avatar" src="{{ user.avatar.medium }}">
                {% endif %}
                <span class="username">{{ user.name }}</span>
                <a class="btn small outline" href="/auth/logout">Logout</a>
            </li>
            {% else %}
            <li><a class="btn primary small" href="/auth/login">Login</a></li>
            {% endif %}
        </ul>
    </nav>
    <button aria-label="Toggle color theme" class="theme-toggle" id="themeToggle">
        <span class="icon">ðŸŒ“</span>
    </button>
</header>

<div class="layout">
    <main class="content">
        {% if messages %}
        <div class="messages">
            {% for m in messages %}
            <div class="message {{ m.category|default('info') }}">{{ m.text }}</div>
            {% endfor %}
        </div>
        {% endif %}
        {% block content %}{% endblock %}
    </main>
    <aside class="sidebar">
        {% block sidebar %}
        <section class="panel">
            <h3>Status</h3>
            {% if user %}
            <p>Logged in as <strong>{{ user.name }}</strong></p>
            {% else %}
            <p>You are not logged in.</p>
            {% endif %}
        </section>
        {% endblock %}
    </aside>
</div>

<script>
    (function () {
        const root = document.documentElement;
        const btn = document.getElementById('themeToggle');
        const stored = localStorage.getItem('theme');
        if (stored) root.setAttribute('data-theme', stored);
        btn?.addEventListener('click', () => {
            const current = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            root.setAttribute('data-theme', current);
            localStorage.setItem('theme', current);
        });
    })();
</script>
{% block scripts %}{% endblock %}
</body>
</html>